<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2000-2008 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html>
<head>
<TITLE>Multiscale Models</TITLE>
</head>
<body>
<h3>Multiscale Models <img src="multicon.png" alt="Multiscale icon"></h3>

<img src="1fav.png" align="right" alt="1fav">

<p>
<b>Multiscale Models</b> facilitates exploration of
macromolecular assemblies, especially large, complicated structures
such as viral capsids and ribosomes, by:
<ul>
<li>creating multimers from coordinates and matrices in PDB files
<li>generating low-resolution surfaces for efficient viewing
<li>allowing navigation within user-defined structural hierarchies
</ul>
The state of <b>Multiscale Models</b> is included in saved 
<a href="../../UsersGuide/sessions.html#sesdef">sessions</a>.
See also:
<a href="../unitcell/unitcell.html"><b>Unit Cell</b></a>,
<a href="../flatten/flatten.html"><b>Flatten Icosahedron</b></a>,
<a href="../../UsersGuide/midas/sym.html"><b>sym</b></a>,
<a href="../../UsersGuide/midas/measure.html#inertia"><b>measure 
inertia</b></a>, <a href="../../UsersGuide/midas/msc.html"><b>msc</b></a>,
and the following reference:
<blockquote>
<a href="http://www.ncbi.nlm.nih.gov/pubmed/15766548" target="_blank">
Software extensions to UCSF chimera for interactive visualization of 
large molecular assemblies.</a>
Goddard TD, Huang CC, Ferrin TE.
<i>Structure.</i> 2005 Mar;13(3):473-82.
</blockquote>
<b>Multiscale Models</b>
is under active development, and suggestions for improvements
are welcome (send to <a href="mailto:chimera-users@cgl.ucsf.edu">
chimera-users@cgl.ucsf.edu</a>).
</p><p>
There are <a href="../../UsersGuide/extension.html">
several ways to start</a> <b>Multiscale Models</b>,
a tool in the <b>Higher-Order Structure</b> category.
When a <a href="../../UsersGuide/filetypes.html#viperdata">VIPER file</a>
is read, <b>Multiscale Models</b> is automatically started
and used to construct the virus capsid.
</p><p>
The dialog has three sections:
<ul>
<li><a href="#selectchains"><b>Select chains</b></a>
<li><a href="#actchains"><b>Act on selected chains</b></a>
<li><a href="#models"><b>Models from molecules and matrices</b></a>
</ul>
Contents are described below in an order reflecting the
general work flow.
</p>

<h4><a name="creating">CREATING MULTISCALE MODELS</a></h4>
<p>
It is first necessary to <a href="../../UsersGuide/startup.html#input">
open</a> a PDB file containing either the coordinates
for an entire multimeric complex (such as a ribosomal subunit)
or coordinates for a lower-order structure and the matrix information
needed to generate a multimer.
</p><p>
Under <a name="models"><b>Models from molecules and matrices</b></a>,
the <b>Multimer</b> setting should be adjusted based on the types
of matrix information present in the file.
Options are:
<ul>
<li><b>Biological oligomer (BIOMT)</b> (see also the command
<a href="../../UsersGuide/midas/sym.html#secondary"><b>sym</b></a>
and <a href="../../UsersGuide/fetch.html">fetching</a> PQS files)
<li><b>Crystal unit cell (MTRIX/SMTRY/CRYST1)</b> 
<li><b>3x3x3 crystal unit cells</b> - produce a 3 by 3 by 3 block of crystal
unit cells for examining crystal packing
<li><b>Crystal symmetry in unit cell (SMTRY/CRYST1)</b>
<li><b>Non-crystal symmetry in unit cell (MTRIX)</b>
<li><b>Icosahedral symmetry, xyz 2-fold axes (VIPER)</b> 
- use 60 matrices to produce icosahedral symmetry 
appropriate for structures in the 
<a href="http://viperdb.scripps.edu/" target="_blank">Virus 
Particle Explorer</a> coordinate system
<li><b>Icosahedral symmetry, xyz 2-fold axes, alt</b> 
- same as the VIPER symmetry, except rotated 90 degrees about the z axis
<li><b>None</b> - do not make additional copies; the
input already contains the entire structure of interest
</ul>
The types of matrix records (if any) in the PDB file can be determined by
viewing the file directly in a text editor, or once the file has been
opened, using the <b>PDB Headers...</b> button near the bottom of the
<a href="../../UsersGuide/moleculeattrib.html">molecule model attributes
panel</a>.  
See <a href="../unitcell/unitcell.html#checkbox"><b>Unit Cell</b></a>
for more information on SMTRY, CRYST1, and MTRIX records.
</p><p>
<a name="makemodels">
Clicking <b>Make models</b> generates the multimer.</a>
Additional copies are shown as <a href="#lowres">surfaces</a>,
while the display of the original chains is kept the same.
However, the original chains (those with loaded atoms) can be
<a href="#selecting">selected</a> and shown in the
<a href="#displaystyle">surface style</a> too.
The surfaces of all copies of a given chain are colored alike. 
The colors are assigned automatically, but can be changed in the
<a href="#actchains"><b>Act on selected chains</b></a> section.
</p><p>
The <a href="#lowres">surfaces</a> 
of all chains in the multimer are opened as a single model. 
The set of atomic coordinates first opened remains present,
although the atoms may be hidden depending on the
<a href="#displaystyle">display style</a>.
Additional copies of the atomic coordinates will be 
<a href="#loading">loaded</a> as needed for
various <a href="#displaystyle">display styles</a>.
<a name="multidef">The surface model and all copies of the PDB model
comprise the <b><i>multiscale model</i></b></a>.
</p><p>
<b>Delete selected models</b>
deletes each <a href="#multidef">multiscale model</a>
with at least one chain <a href="#selecting">selected</a>,
except for the single PDB model that was first opened.
Although the PDB model is undisplayed,
it can be used to <a href="#makemodels">remake</a> the 
<a href="#multidef">multiscale model</a>.
</p>

<h4><a name="lowres">LOW-RESOLUTION SURFACES</a></h4>
<p>
Surfaces generated by <b>Multiscale Models</b> are usually
low resolution, although higher resolutions can be specified.
Low-resolution surfaces are efficient for display because
they are graphically simple and require much less memory
than the corresponding atomic coordinates.  
Resolution and other surface parameters can be adjusted in the
<a href="#actchains"><b>Act on selected chains</b></a> section.
Surface display style, color, and transparency can also be adjusted
with the main Chimera
<a href="../../UsersGuide/menu.html#menuactions"><b>Actions</b> menu</a>.
</p><p>
The <b>Multiscale Models</b> dialog does not act on standard
<a href="../../UsersGuide/representation.html#surfaces">molecular surfaces</a>,
and several Chimera commands that act on molecular surfaces do not
affect surfaces from <b>Multiscale Models</b>.
Although a surface created by <b>Multiscale Models</b> with
<a href="#resolution">resolution</a> set to 0
will have the same geometry as a molecular surface, it is not
implemented in the same way.
</p><p>
Another way to show a low-resolution surface for atomic coordinates is to
calculate a density map from the coordinates with
<a href="../../UsersGuide/midas/molmap.html"><b>molmap</b></a>
and display an isosurface of that density.
</p>

<img src="bluetongue.png" alt="2btv" align="right">

<h4><a name="hierarchy">STRUCTURAL HIERARCHY</a></h4>
<p>
By default, the structural hierarchy contains three levels:  PDB chain,
PDB molecule, and multimer.  To define a different set of levels,
it is necessary to write a Python script to create the <a href="#multidef">
multiscale model</a> instead of using the <b>Make models</b> button.
Plans are to develop a user interface for defining the hierarchy.
</p><p>
The default levels sometimes correspond poorly to
biologically significant levels of structure. For
example, the bluetongue virus capsid (2btv, see the figure)
is a two-layered structure, with an outer shell made up of trimers 
in five symmetry classes and an inner shell composed of dimers.
The PDB file contains 17 chains
comprising one asymmetric unit of the full virus shell, which is a 60-mer.
Levels such as shell, dimer, trimer, and trimer class would be useful in
this case. The Python script <a href="bluetongue.py">bluetongue.py</a> loads
2btv and creates the <a href="#multidef">multiscale model</a>
with these levels of structure. 
</p>

<h4><a name="selecting">SELECTING COMPONENTS</a></h4>
<p>
<a name="chainsel">
A chain can be selected</a> 
by picking its <a href="#lowres">surface</a>
in the same way that atoms and bonds are
<a href="../../UsersGuide/selection.html#pickselect">picked</a>
(by default, with <b>Ctrl</b>-left mouse button click).
If the <b>Shift</b> key is held down at the same time,
the selection is added to (or subtracted from, if already selected)
the previous selection rather than replacing it.
Even though a single chain may appear as disjoint segments, the entire
chain is selected, as indicated by highlighting of the surface.
</p><p>
When a chain has been selected by picking its <a href="#lowres">surface</a>, 
its constituent atoms and bonds are not selected.  However,
if the surface or any atoms or bonds within the chain are selected, 
<b>Multiscale Models</b> considers the chain selected.
Even though the chain selection highlighting is only visible on the
surface, the chain remains selected when shown
in other <a href="#displaystyle">display styles</a>.
</p><p>
The <a name="selectchains"><b>Select chains</b></a> section provides
several ways to adjust the selection:
<ul>
 <li><b>All</b> - select all chains in all <a href="#multidef">
   multiscale models</a>; useful for showing hidden models
 <li><b>With loaded atoms</b> 
   - select the chains for which atomic coordinates are
   already <a href="#loading">loaded</a> (to avoid making extra copies 
   for higher-resolution <a href="#displaystyle">display styles</a>)
 <li><b>Clear</b> - return to a state with nothing selected
</ul>
An existing chain selection can be extended:
<ul>
 <li><b>Up</b> - promote the selection to the next higher
   level in the hierarchy (by default, PDB chain -> PDB molecule ->
   all copies of the molecule in the multimer)
 <li><b>Copies</b> 
  - promote the selection to all copies of the selected chains
 <li><b>Atoms</b> - 
  also <a href="../../UsersGuide/selection.html">select</a> the 
  constituent atoms and bonds, <a href="#loading">loading</a> 
  additional copies of the coordinates as required
 <li><b>Loaded atoms</b> - 
  also <a href="../../UsersGuide/selection.html">select</a> the 
  constituent atoms and bonds with coordinates
  already <a href="#loading">loaded</a>
</ul>
The following options depend on which of the atoms within a chain are selected:
<ul>
  <li><b>Near</b> <i>expands</i> the selection
  to include additional atoms
  within <b>Range</b> &Aring; of the original selection
  <li><b>Contacts</b> <i>changes</i> the selection to
  include the atoms in the initially unselected set
  within <b>Range</b> &Aring; of the original selection,
  and the atoms in the original selection
  <i>within <b>Range</b> &Aring; of the initially unselected set</i>
</ul>
The resulting selection also includes all bonds between selected atoms.
If the original selection contains
multiscale model <a href="#chainsel">chain selections</a>
without any selection of specific constituent atoms,
all of the atoms in the selected chains
are considered part of the original selection.
The coordinates of all atoms within 
<a href="#multidef">multiscale model</a> chains are included in the
distance calculations, whether <a href="#loading">loaded</a> or not.
If the <b>Load atoms</b> option is on, any virtual (not-yet-loaded)
copies with atoms within <b>Range</b> will be 
<a href="#loading">loaded</a> and the
specific atoms within <b>Range</b> will be selected.
</p>

<img src="multidialog.png" align="right" alt="Multiscale dialog">

<h4><a name="display">DISPLAY OPTIONS</a></h4>
<p>
Buttons in the <a name="actchains"><b>Act on selected chains</b></a>
section control how chains are displayed.
Display styles, color, and transparency can also be adjusted
with the main Chimera
<a href="../../UsersGuide/menu.html#menuactions"><b>Actions</b> menu</a>.
</p><p>
<b>Show</b> and <b>Hide</b> display and undisplay 
<a href="#lowres">surfaces</a>, respectively; 
<b>Hide all styles</b> undisplays all
<a href="#displaystyle">display styles</a>.
This can be done for the <b><a href="#selecting">Selected</a> chains</b> or
for <b>Other chains</b> (the unselected chains within each 
<a href="#multidef">multiscale model</a> containing at least one 
selected chain).  The rest of the section affects only 
the <a href="#selecting">selected</a> chains.
</p><p>
The <a name="displaystyle"><b>Style</b> for display</a> can be
<ul>
<li><b><a href="#lowres">Surface</a></b>
<li><b>Ribbon</b>
<li><b>Wire</b>
<li><b>Stick</b>
<li><b>Ball & Stick</b>
<li><b>Sphere</b>
</ul>
All styles except <b>Surface</b> require atomic coordinates
to be <a href="#loading">loaded</a>.
<b>Show..</b> displays the chains in the chosen style only. 
<b>Show also...</b> adds the chosen style to what is already shown,
except that a given set of atoms and bonds can only be shown with 
one <a href="../../UsersGuide/representation.html">representation</a>
at a time (wire, stick, ball-and-stick, or sphere).
<b>Hide...</b> can be used to undisplay <b>Surface</b>, <b>Ribbon</b>, or
<b>Atoms and Bonds</b>.
</p><p>
<b>Color</b> and <b>Transparency</b> apply to
<a href="#lowres">surfaces</a> only
(although there are buttons to color <b>Atoms</b> and 
<b>Ribbons</b> to match).  Clicking the
<a href="../../UsersGuide/coloring.html#colorwell"> color well</a>
allows the color to be adjusted with the
<a href="../../UsersGuide/colortool.html"><b>Color Editor</b></a>.
Transparency can also be adjusted using the 
<a href="../../UsersGuide/colortool.html"><b>Color Editor</b></a>
(opacity = A = 1 - transparency) or by typing a value in the 
<b>Transparency</b> field and pressing return (Enter).
Transparency can range from 0 to 1; values below or above the range 
are treated as 0 or 1, respectively.
</p><p>
<a name="resolution">
The <b>Resolution</b></a>
(<b>8</b> by default) controls the level of detail
in a <a href="#lowres">surface</a>; a higher number gives a lower resolution.
A low-resolution surface is made by counting the atoms in each cell of a
three-dimensional grid and then making an isosurface of this occupancy map.
The <b>Resolution</b> is the grid spacing in display units (usually &Aring;).
The isosurface is smoothed to reduce artifacts associated with
using an arbitrarily aligned grid.
</p><p>
Setting the <b>Resolution</b> to 0, however, triggers calculation of a 
solvent-excluded molecular surface instead of an isosurface, based on the
current <a href="../../UsersGuide/midas/vdwrad.html">VDW radii</a> and
<a href="../../UsersGuide/preferences.html#New Surfaces"><b>New
Surfaces</b> preferences</a> for probe radius, vertex density, and 
disjoint surfaces.
This <b>Multiscale Models</b> molecular surface is not affected by the 
<a href="#moreparms">threshold and smoothing parameters</a> and will not be
updated to reflect any subsequent changes in the underlying atoms or their
<a href="../../UsersGuide/midas/vdwrad.html">VDW radii</a>. 
</p><p>
It is necessary to press return (Enter) or click <b>Resurface</b>
to recalculate the surface after changes in
<b>Resolution</b> or the numerical parameters described below.
</p><p>
<a name="moreparms">
The checkbutton marked "<b>...</b>" reveals 
additional adjustable parameters</a>:
    <ul>
    <li><b>Threshold atom density [<i>D</i>] CA only [<i>d</i>]</b> 
     (<i>D</i>=<b>0.02</b> and <i>d</i>=<b>0.002</b> by default) 
     - the isosurface threshold in atoms per unit volume (usually 
     &Aring;<sup>3</sup>); <i>d</i> is used for chains with CA atoms only
    <li><b>Smoothing factor</b> (<b>0.3</b> by default) - how much to smooth
     the isosurface during each step.  In one smoothing step,
     each surface vertex is moved some fraction of the way toward the average
     position of the neighboring vertices.  This fraction is the
     <b>Smoothing factor</b>.
    <li><b>Smoothing iterations</b> (<b>2</b> by default) -
     how  many smoothing steps to perform
    </ul>
<b>Delete chains</b> undisplays the selected chains and removes
them from the <a href="#multidef">multiscale model</a>.  
Deleted chains cannot be restored except by 
<a href="#makemodels">remaking</a> the 
<a href="#multidef">multiscale model</a>.
If all of the chains in the <a href="#multidef">multiscale model</a>
are deleted, the surface model is closed.
Although undisplayed, atomic coordinates for the selected chains
are not deleted if part of the original set (the PDB model first opened)
or a copy with any chain that has not been deleted.
</p>

<h4><a name="loading">LOADING ATOMIC COORDINATES</a></h4>
<p>
Atomic coordinates are loaded for the PDB model first opened, but
additional copies of the coordinates are loaded only as needed, when 
<a href="#displaystyle">display styles</a> other than 
<a href="#lowres">surfaces</a> are shown.
</p><p>
When possible, copies are made from the coordinates already in memory
rather than by opening the original input file multiple times.
If all copies of the atomic coordinates have been deleted, however,
Chimera will try to open the original input PDB file again.
If the file no longer exists in the same location, an error message
will appear.  There is currently no way of indicating that
the file is available in a different location.  Solutions are to
restore the file to its former location or, in the context of a
saved <a href="../../UsersGuide/sessions.html#sesdef">session</a>,
to change the location information within the 
<a href="../../UsersGuide/sessions.html#sesdef">session</a> file before
<a href="../../UsersGuide/sessions.html#restartsess">restarting</a>.
</p><p>
Sometimes an excessive amount of coordinate copying is inadvertently
set in motion.  A dialog enabling the process to be halted will appear  
after 5 seconds of coordinate copying.  Clicking <b>Stop</b> halts 
copying after the copy in progress is complete.
</p>
<hr>
<address>UCSF Computer Graphics Laboratory / July 2008</address>
</body>
</html>
