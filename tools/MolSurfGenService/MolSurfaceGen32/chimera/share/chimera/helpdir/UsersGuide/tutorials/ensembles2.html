<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2005-2009 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html><head>
<title>Trajectory and Ensemble Analysis Tutorial</title>
</head><body>
<font size="-1">
<a href="../frametut.html" target="_top">Chimera Tutorials Index</a>
</font>

<h2>Trajectory and Ensemble Analysis Tutorial</h2>
<p>
This tutorial focuses on visualization and analysis of molecular dynamics
(MD) trajectories and other structural ensembles with the 
<a href="../../ContributedSoftware/movie/framemovie.html" 
target="_top"><b>MD Movie</b></a> tool.
<a href="#part1">Part 1</a> uses an MD trajectory of a collagen peptide,
and <a href="#part2">Part 2</a> uses an NMR ensemble of Met-enkephalin.
</p>

<hr>
<a name="part1">
<h3>Part 1 - Collagen Peptide</h3></a>

<table align="right" style="margin:8px 8px 8px 8px"><a name="collfig">
<tr><td><img src="collagen.png"></td></tr>
</a>
</table>

<p>
We will view an MD trajectory of the nonmutant collagen peptide 
described in:
<blockquote>
<a href="http://www.ncbi.nlm.nih.gov/pubmed/15122897" target="_blank">
Severity of osteogenesis imperfecta and structure of a collagen-like 
peptide modeling a lethal mutation site.</a>
Radmer RJ, Klein TE.
<i>Biochemistry.</i> 2004 May 11;43(18):5314-23.
</blockquote>
(Thanks to the authors for providing the data!)
To follow along, <a href="download.html">download</a> the data files:
  <ul>
  <li><a href="leap.top" type="text/plain">leap.top</a> 
- <a href="http://ambermd.org/index.html" target="_blank"><b>Amber</b></a>
   parameter/topology file
  <li><a href="md01.crd" type="text/plain">md01.crd</a> 
- <a href="http://ambermd.org/index.html" target="_blank"><b>Amber</b></a>
   trajectory file
  <li><a href="collagen.meta" type="text/plain">collagen.meta</a> - metafile 
  specifying these input files for 
  <a href="../../ContributedSoftware/movie/framemovie.html" 
  target="_top"><b>MD Movie</b></a> 
  </ul>
On <b>Windows</b>/<b>Mac</b>, click the <b>chimera</b> icon;
on <b>UNIX</b>, start Chimera from the system prompt:
<blockquote><tt>
<i>unix</i>: <b>chimera</b>
</tt></blockquote>
A basic Chimera window should appear after a few seconds.
</p><p>
Show the <a href="../chimerawindow.html#emulator"><b>Command Line</b></a>
(<b>Tools... General Controls... Command Line</b>) and start
<a href="../../ContributedSoftware/movie/framemovie.html" 
target="_top"><b>MD Movie</b></a> 
(<b>Tools... MD/Ensemble Analysis... MD Movie</b>).
In the resulting dialog, the inputs can be specified in two different ways:
<ul>
<li> by setting the <b>Trajectory format</b> to <b>Amber</b> and
browsing to the <b>Prmtop</b> file 
<a href="leap.top" type="text/plain">leap.top</a> 
and the <b>Trajectory</b> file
<a href="md01.crd" type="text/plain">md01.crd</a>
<li> by setting the <b>Trajectory  format</b> to <b>metafile</b>
and browsing to the file 
<a href="collagen.meta" type="text/plain">collagen.meta</a>
(it must be in the same directory or folder as the other two files).
It contains the following lines, which simply specify the options 
and filenames that would otherwise be entered into the dialog:
<pre>
amber
leap.top
md01.crd
</pre>
</ul>
Once the inputs have been specified, click <b>OK</b>.
The first set of coordinates will be displayed and 
the <b>MD Movie</b> controller will appear.
If the controller becomes obscured by other windows, 
it can be raised using its <a href="../instances.html">instance
in the <b>Tools</b> menu</a> 
(near the bottom of the menu, below the horizontal line).
</p><p>
Apply interactive preset #2 to display all atoms with heteroatom color-coding:
<blockquote>
<i>Command</i>: <b><a href="../midas/preset.html">preset</a> apply int 2</b>
</blockquote>
Undisplay hydrogens, change to the stick representation, and show the
backbone as ribbons:
<blockquote>
<i>Command</i>: <b><a href="../midas/display.html">~disp</a> H</b>
<br>
<i>Command</i>: <b><a href="../midas/represent.html">repr stick</a></b>
<br>
<i>Command</i>: <b><a href="../midas/ribbon.html">ribbon</a></b>
</blockquote>
<a href="../mouse.html">Move and scale</a> the structure
as desired throughout the tutorial. 
The structure contains three chains. Each chain is in a left-handed
polyproline II helix conformation, and together the chains form
the right-handed triple helix characteristic of fibrillar collagen.
The ribbons are narrow because the peptides are not in a standard
alpha-helical conformation.
</p><p>
<table align="right" style="margin:8px 8px 8px 8px">
<tr><th align="center">
MD Movie<br>controller buttons</th></tr>
<tr><td align="center"><img src="buttons.png"></td></tr>
</table>
<a name="controller">
Use the <b>MD Movie</b> controller to play the trajectory.
</a>
From left to right, the buttons mean: play backward continuously;
go back one step; stop; go forward one step; and play forward continuously.
The rate of continuous play can be adjusted with the
<b>Playback speed</b> slider.
The <b>Frame</b> number is reported and can also be entered
directly to view a specific frame.  
<b>Frame</b> number and <b>Step size</b> changes take effect when
return (<b>Enter</b>) is pressed.
</p><p>
Show the amino acid sequence with 
<b>Tools... Sequence... Sequence</b> 
(pick any one of the three chains).
Fibrillar collagen typically contains many -Gly-X-Y- repeats,
where X is often Pro (proline) and Y is often Hyp (hydroxyproline).
Both Pro and Hyp are shown as P in the sequence panel.  
Selecting residues highlights both the sequences and the structures:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">sel</a> :gly</b>
<br>
<i>Command</i>: <b><a href="../midas/select.html#newer">sel</a> :pro</b>
<br>
<i>Command</i>: <b><a href="../midas/select.html#newer">sel</a> :hyp</b>
</blockquote>
<b>Quit</b> from the sequence panel.
</p><p>
It may be useful to hold certain atoms steady during trajectory playback.
For example, hold Glu-86 steady to view its interactions:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">sel</a> :86</b>
<br>
(from the controller menu) <b>Actions... Hold selection steady</b>
<br>
<i>Command</i>: <b><a href="../midas/color.html">color</a> magenta sel</b>
<br>
<i>Command</i>: <b><a href="../midas/select.html#newer">~sel</a></b>
</blockquote>
Even though it is no longer selected,
residue 86 will be held steady during playback 
(as possible; there will still be internal motions)
until <b>Hold selection steady</b> with a different selection or 
<b>Stop holding steady</b> is used.  The structure
can still be moved with the mouse, however.  Try playing the trajectory
with residue 86 held steady and then without holding any atoms steady
(from the controller menu, choose <b>Actions... Stop holding steady</b>).
</p><p>
We will create a short movie of several frames in the trajectory.
The following procedure is just one example; 
there are many possibilities of what to show, how to show it,
whether to use a script, and so on.
</p><p>
Adjust the Chimera window to the dimensions desired for the movie.
If needed, use the <a href="../sideview.html#sideview"><b>Side View</b></a> 
(<b>Tools... Viewing Controls... Side View</b>) to adjust the clipping planes.  
Turn off the ribbon to reveal the backbone atoms:
<blockquote>
<i>Command</i>: <b><a href="../midas/ribbon.html">~ribbon</a></b>
</blockquote>
Use
<a href="../../ContributedSoftware/2dlabels/2dlabels.html"><b>2D Labels</b></a> 
(<b>Tools... Utilities... 2D Labels</b>) to add a title.
When <b>Use mouse for label placement</b> is checked,
the left mouse button (button 1) is reassigned to
labeling: clicking starts a new 2D label and previously created 2D
labels can be repositioned by dragging.  Click in the Chimera window
where you would like to start a title and type in the title text;
drag the text if you want to reposition it.
Adjust the <b>Font size</b> and <b>Color</b> (click the
<a href="../coloring.html#colorwell">color well</a>, use the
<a href="../colortool.html"><b>Color Editor</b></a>) to your liking. 
Unchecking <b>Use mouse for label placement</b>
returns the left mouse button to its previous function
(by default, <a href="../mouse.html">rotation</a>).
</p><p>
Create another 2D label, this time using the
<a href="../midas/2dlabels.html"><b>2dlabels</b></a> command
so that the label will have a name:
<blockquote>
<i>Command</i>: <b><a href="../midas/2dlabels.html">2dlabels</a>&nbsp;create&nbsp;mylabel&nbsp;text&nbsp;temp</b>
</blockquote>
This label will be used to display the frame number.
In the <b>2D Labels</b> dialog,
make sure that <b>Use mouse for label placement</b> is checked,
then drag the temporary text to near the lower left
corner of the Chimera window.
Adjust its <b>Font size</b> and <b>Color</b> to your liking, then
<b>Close</b> the <b>2D Labels</b> dialog.
</p><p>
Next, define a script to execute at each frame.
Halt any playback.  From the <b>MD Movie</b> controller menu, 
choose <b>Per-Frame... Define script</b>.  
Enter a script to be interpreted as <b>Chimera commands</b>:
<blockquote>
<b><a href="../midas/hbonds.html">findhbond</a> linewidth 2 color yellow</b>
<br>
<b><a href="../midas/2dlabels.html">2dlabels</a> change mylabel text "frame &lt;FRAME&gt;"</b>
</blockquote>
Uncheck the option to <b>Use leading zeroes...</b>
This script will calculate the hydrogen bonds in each frame,
show them as yellow lines, and display the current frame number in
the label named <b>mylabel</b>. 
 Click <b>OK</b> to dismiss the dialog with the script.  
Play a few steps by clicking the button to go forward or
backward one step at a time.
The number and arrangement of H-bonds vary somewhat from step to step.
(Although the number of H-bonds cannot be accessed in <b>Chimera commands</b>,
a <b>Python</b> script could be used to display this information.  For example,
<a href="hbcount.py" type="text/plain">hbcount.py</a> 
would show the H-bond count instead of the frame number in <b>mylabel</b>.)
</p><p>
Halt any playback, but move the
<b>Playback speed</b> slider all the way to the right.
From the controller menu, choose <b>File... Record movie</b>.
If a dialog with an MPEG license agreement appears,
click <b>Accept</b> since the movie will not be used for commercial
purposes.  In the dialog for recording, 
<ul>
<li>choose a <b>File type</b> you will be able to play back on your computer 
(the choices are MPEG-1, MPEG-2, MPEG-4, AVI MSMPEG-4v2, and Quicktime)
<li>specify a convenient name and location for the output file
<li>change the <b>Ending frame</b> to 25
<li>click <b>Record</b>
</ul>
Frames 1-25 will then be played, saved as images, and
automatically assembled into a movie file.  View the resulting 1-second movie
with the appropriate application on your computer.
</p><p>
Click <b>Quit</b> on the controller to close the trajectory and 
exit from <b>MD Movie</b>. An easy way to delete all of the 2D labels is
with <b>File... Close Session</b>.
Go on to <a href="#part2"><b>Part 2</b></a> below, 
<b>OR</b> terminate the Chimera session:
<blockquote>
<i>Command</i>: <b><a href="../midas/stop.html">stop</a></b>
</blockquote>
</p>

<hr>
<a name="part2">
<h3>Part 2 - Met-Enkephalin</h3></a>
<p>
We will view an NMR ensemble of Met-enkephalin in
negatively charged bicelles, as described in:
<blockquote><a name="enk-ref">
<a href="http://www.ncbi.nlm.nih.gov/pubmed/14990485" target="_blank">
A multidimensional 1H NMR investigation of the conformation of 
methionine-enkephalin in fast-tumbling bicelles.</a>
Marcotte I, Separovic F, Auger M, Gagn&eacute; SM.
<i>Biophys J.</i> 2004 Mar;86(3):1587-600.
</blockquote>
To follow along, <a href="download.html">download</a> 
the data file <a href="1plx.pdb" type="text/plain">1plx.pdb</a>.
</p><p>
With Chimera started and the
<a href="../chimerawindow.html#emulator"><b>Command Line</b></a> shown
(as in <a href="#part1">Part 1</a>), choose
<b>Tools... MD/Ensemble Analysis... MD Movie</b>. 
In the resulting dialog, choose <b>PDB</b> as the <b>Trajectory format</b>
and indicate that the frames are contained in a <b>single file</b>.  
Browse to the file <a href="1plx.pdb" type="text/plain">1plx.pdb</a>, 
set the input location, and then click <b>OK</b>.
</p><p>
The first set of coordinates will be displayed and 
the <b>MD Movie</b> controller will appear.
If the controller becomes obscured by other windows, 
it can be raised using its <a href="../instances.html">instance
in the <b>Tools</b> menu</a>
(near the bottom of the menu, below the horizontal line).
</p><p>
Use a preset to show the structure as sticks color-coded by heteroatom:
<blockquote>
<i>Command</i>: <b><a href="../midas/preset.html">preset</a> apply int 1</b>
</blockquote>
(The structure may have been shown that way already, depending on your
preference settings.)
<a href="../mouse.html">Move and scale</a> the structure
as desired throughout the tutorial.  
</p><p>
This structure is Met-enkephalin, with the sequence Tyr-Gly-Gly-Phe-Met.  
Enkephalins are neuropeptides that activate opioid receptors. 
Different subtypes of opioid receptors
mediate different but overlapping responses in the body.  
For example, molecules that selectively activate &mu;-opioid receptors
are more effective for treating severe pain than molecules that selectively
activate &delta;-opioid receptors, but are also more likely to cause 
constipation.  
The conformations of molecules that bind opioid receptors
(enkephalins, morphine, <i>etc.</i>)
are of interest because they influence the selectivity
of receptor binding and thus the physiological response.
</p><p>
Use the <b>MD Movie</b> controller to flip through the different
conformations, as described <a href="#controller">above</a>.  
The frames do not reflect time ordering, as this is an NMR
ensemble rather than a trajectory.
If desired, simplify the view by undisplaying hydrogens:
<blockquote>
<i>Command</i>: <b><a href="../midas/display.html">~disp</a> H</b>
</blockquote>
</p><p>
It is thought (see the
<a href="#enk-ref">reference</a> and papers cited therein) that
a conformation of enkephalin in which the Tyr and Phe rings
point in different directions (like frames 1 and 25) 
binds to &mu;-opioid receptors
and a conformation in which they
point toward each other (like frames 2 and 80)
binds to &delta;-opioid receptors.
</p><p>
<table border="1" align="right" style="margin:8px 8px 8px 8px"> 
<tr><td><img src="rmsdmap.png"></td></tr>
</table>
One way to analyze the ensemble is to calculate
root-mean-square deviations (RMSDs) between pairs of frames.
From the controller menu, choose <b>Analysis... RMSD map</b>.
Click <b>Apply</b> on the RMSD parameters dialog to perform
the calculation without closing the dialog.  This will compute
all pairwise RMSDs between frames and show the result as a map
in grayscale.  After the initial calculation, the map will be
recolored to enhance contrast. 
</p><p>
In the RMSD map, the axes are frame numbers; lighter squares
reflect pairs of frames with lower RMSDs (more similar structures) and 
darker squares reflect pairs of frames with higher RMSDs 
(less similar structures).  Mousing over the map shows the RMSD
values and the numbers of the frames being compared.  Clicking 
on the map enters the corresponding pair of <b>Frame</b> numbers
below the map.  Clicking <b>Go</b> then displays that frame in the
main Chimera window.  
</p><p>
Roughly, the upper left block of white in the map
represents conformations more similar to to a &mu;-binding conformation,
and the lower right block of white represents conformations more similar
to a &delta;-binding conformation.
Similar conformations are mostly grouped together in this ensemble,
but will not necessarily be grouped together in ensembles in general.
Also, ensembles usually contain many more
groups of conformations, especially for
larger structures with more degrees of freedom.
</p><p>
All atoms were used in the RMSD calculation, because although 
the parameter <b>Restrict map to current selection, if any</b> 
was set to <b>true</b>, nothing was selected.  
Select the nonhydrogen backbone atoms only,
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">sel</a> @n,ca,c,o</b>
</blockquote>
and this time click <b>OK</b> to dismiss the RMSD parameters dialog
and perform the calculation.  Although the two maps span different
ranges in RMSD, they reveal essentially the same groups of conformations.
<b>Close</b> both maps.
</p><p>
Another way to analyze the ensemble is to calculate spatial 
occupancy maps for atoms of interest.  From the controller menu,
choose <b>Analysis... Calculate occupancy</b>.  The resulting dialog
will show the warning message "No atoms being held steady."
This means you have not previously
<a href="../selection.html">selected</a> a set of atoms and chosen
<b>Actions... Hold selection steady</b> from the controller menu
for this ensemble.
</p><p>
Why might it be useful to hold atoms steady while calculating occupancy?
The contents of different frames may move around enough to
obscure certain spatial patterns.
Even if the structure as a whole is held fairly steady,
one may want to hold a particular set of atoms (such as a sidechain)
steady to examine local interactions. However, if
the structure or region of interest is already sufficiently steady, 
the "hold steady" step can be omitted.
</p><p>
One approach to analyzing the relative positions of the aromatic rings is to
hold the Phe ring atoms steady and map the occupancy of the Tyr ring atoms:
<ol>
<li> <a href="../selection.html">Select</a> 
<a name="selphe">the six Phe ring atoms</a>.
One way is to pick them from the screen (Ctrl-click on one,
Shift-Ctrl-click on each of the  other five).
Another way is with a command:
<blockquote>
<i>Command</i>: 
<b><a href="../midas/select.html#newer">sel</a> :phe & aromatic ring</b>
</blockquote>
<li> Choose <b>Actions... Hold selection steady</b> from the controller menu.
<li> <a href="../selection.html">Select</a> the six Tyr ring atoms,
by picking or with a command:
<blockquote>
<i>Command</i>: 
<b><a href="../midas/select.html#newer">sel</a> :tyr & aromatic ring</b>
</blockquote>
<li> If the occupancy dialog is not already up, choose 
<b>Analysis... Calculate occupancy</b> from the controller menu.
<li> Click <b>OK</b> on the occupancy dialog.
</ol>
<a name="blobs">
<table align="right" style="margin:8px 8px 8px 8px">
<tr><th align="center">frame 1 (&mu;-type)</th>
<th align="center">frame 2 (&delta;-type)</th></tr>
<tr><td><img src="frame1.png" alt="frame 1 holding steady"></td>
<td><img src="frame2.png" alt="frame 2 holding steady"></td></tr>
<tr><td><img src="frame1x.png" alt="frame 1 not steady"></td>
<td><img src="frame2x.png" alt="frame 2 not steady"></td>
</table></a>
When the map has been computed, the
<a href="../../ContributedSoftware/volumeviewer/framevolumeviewer.html" 
target="_top"><b>Volume Viewer</b></a> tool will appear.
This tool shows a histogram of the values in the map; the slider controls
what contour level is displayed.  
</p><p>
Clear the selection in Chimera (<b>Select... Clear Selection</b>).
In the <b>Volume Viewer</b> tool, change from <b>surface</b>
to <b>mesh</b> and move the slider to a value of approximately 2.  
If necessary,
use the <a href="../sideview.html#sideview"><b>Side View</b></a> 
(<b>Tools... Viewing Controls... Side View</b>) to move the clipping planes
so that all of the mesh is visible.
Optionally, change the color of the mesh surface by clicking the 
<a href="../coloring.html#colorwell">color well</a> below the histogram
and using the <a href="../colortool.html"><b>Color Editor</b></a>.
(See the 
<a href="../../ContributedSoftware/volumeviewer/framevolumeviewer.html" 
target="_top"><b>Volume Viewer</b> documentation</a> for details
on its many features.)
</p><p>
You will see two main blobs or volumes
representing probable positions of the Tyr ring relative to the Phe ring
(similar to the upper <a href="#blobs">images</a>).
The larger volume represents &mu;-type conformations and 
the smaller represents &delta;-type conformations.
</p><p>
If desired, flip through the ensemble (still holding the Phe ring steady)
to verify that the volumes show areas occupied by the Tyr ring.
To delete the volume display, choose <b>File... Close map</b> from
the <b>Volume Viewer</b> menu.
</p><p>
Finally, calculate a map without holding any atoms steady.
Choose <b>Actions... Stop holding steady</b> from the controller menu.
Since this ensemble maintains the Tyr ring in roughly the same place,
simply map the occupancy of the Phe ring atoms.
Select the Phe ring atoms (as <a href="#selphe">above</a>),
choose <b>Analysis... Calculate occupancy</b>, and click <b>OK</b>.
This time, the conformations are not as well separated;
two lobes of occupancy are apparent at a contour level of approximately 2
(similar to the lower <a href="#blobs">images</a>).
One lobe represents &mu;-type conformations and 
the other represents &delta;-type conformations.
</p><p>
When finished with the Met-enkephalin ensemble,
quit from Chimera (<b>File... Quit</b>).
</p>
<hr>
<address>meng-at-cgl.ucsf.edu / April 2009</address>
</body></html>
