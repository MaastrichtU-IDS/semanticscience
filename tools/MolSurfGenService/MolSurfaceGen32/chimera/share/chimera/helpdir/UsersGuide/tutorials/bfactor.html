<!--
--- UCSF Chimera Copyright ---
Copyright (c) 2009 Regents of the University of California.
All rights reserved.  This software provided pursuant to a
license agreement containing restrictions on its disclosure,
duplication and use.  This notice must be embedded in or
attached to all copies, including partial copies, of the
software or any revisions or derivations thereof.
--- UCSF Chimera Copyright ---
-->

<html><head>
<title>Image Tutorial: B-Factor Coloring</title>
</head><body>
<font size="-1">
<a href="../frametut.html" target="_top">Chimera Tutorials Index</a>
</font>

<h2>Image Tutorial: B-Factor Coloring</h2>

<table border align="right" style="margin:8px 8px 8px 8px" 
cellpadding="0" cellspacing="0">
<tr>
<td><a href="2gbp-bfactor.png"><img src="2gbp-bfactor.png" width="250"
height="193" title="click for full-sized image..."></a></td>
</tr>
</table>
</a>

<p>
The recipe here is just one possibility; there are usually several ways 
to get the same or similar results.
See also:
<a href="../menu.html#menupresets">presets</a>,
<a href="../print.html#tips">tips on preparing images</a>
</p><p>
<a href="../startup.html">Start Chimera</a> and
show the <a href="../chimerawindow.html#emulator"><b>Command Line</b></a>
(for example, with <b>Favorites... Command Line</b>).
Fetch Protein Data Bank entry
<a href="http://www.rcsb.org/pdb/cgi/explore.cgi?pdbId=2GBP"
target="_blank">2gbp</a>: 
<blockquote>
<i>Command</i>: <b><a href="../midas/open.html">open</a> 2gbp</b>
</blockquote>
Use the "all atoms" preset and delete the water:
<blockquote>
<i>Command</i>: <b><a href="../midas/preset.html">preset</a> apply int 2</b>
<br>
<i>Command</i>: <b><a href="../midas/delete.html">delete</a> solvent</b>
</blockquote>
Resize the window as desired, either by dragging its lower right corner 
with the mouse or by using the command
<a href="../midas/windowsize.html"><b>windowsize</b></a>. 
The window dimensions define the aspect ratio (width:height)
of output images, but image resolution (pixel dimensions)
can be specified independently when an image is saved.
</p><p>
The <a href="2gbp-bfactor.png">example image</a> was saved with pixel 
dimensions 573 x 443 from a window of that same size:
<blockquote>
<i>Command</i>: <b><a href="../midas/windowsize.html">windowsize</a> 573 443</b>
</blockquote>
Move and scale the structure <a href="../mouse.html">using the mouse</a> and the
<a href="../sideview.html#sideview"><b>Side View</b></a>
as you wish throughout the tutorial.
</p>

<h3>Coloring by B-Factor</h3>
<p>
Start <a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> (under <b>Tools... Depiction</b>) and make sure it is
set to show the <a href="../../ContributedSoftware/defineattrib/defineattrib.html#attribdef">attributes</a> of <b>atoms</b>.  
Look in the <b>Attribute</b> list to see what is available: 
<b>bfactor</b> and <b>occupancy</b>, which were read from the input PDB file.
Choose <b>bfactor</b>; a histogram of the values will
appear, with blue, white and red vertical bars (or 
<a href="../../ContributedSoftware/render/render.html#thresh">thresholds</a>).
</p><p>
You can control how colors will map to B-factor values
by dragging the thresholds along the histogram and/or changing their colors.
The <b>Value</b> and <b>Color</b> are shown for the
most recently clicked or moved threshold.  The <b>Value</b> changes
when the threshold is moved, or the position can be changed by
entering a value and pressing return. The <b>Color</b> can be changed
by clicking the square <a href="../coloring.html#colorwell">color well</a>
and using the <a href="../colortool.html"><b>Color Editor</b></a>.
The slider positions in the editor can be adjusted, or a
<a href="../colortables.html#allcolors">color name</a> 
simply entered in the <b>Color name</b> field.
</p><p>
To make the <a href="2gbp-bfactor.png">example image</a>, 
a <b>blue</b> threshold at value 2, a <b>red</b> threshold at 30, 
and a <b>yellow</b> threshold at 50 were used.
Clicking <b>Apply</b> shows the currently defined color scheme on the
structure.  Once you have the desired coloring, click 
<b>Create corresponding color key</b>, but then just <b>Close</b> both the 
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></b></a> and
<a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> dialogs.
Although the color key has now been set up to match the coloring scheme, 
we will not draw it in the Chimera window until later.
</p><p>
Alternatively, instead of the graphical interface, 
a command could have been used to perform the coloring:
<blockquote>
<i>Command</i>: <b><a href="../midas/rangecolor.html">rangecolor</a> bfactor key 2 blue 30 red 50 yellow</b>
</blockquote>
(The <b>key</b> keyword sets up the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></a> dialog; as explained above, just close that dialog for now.)
While the command is more concise, the 
<a href="../../ContributedSoftware/render/render.html#render"><b>Render
by Attribute</b></a> graphical interface is friendlier in that it
does not require previous knowledge of the attribute names, and it provides 
visual (histogram) information on the value distribution.
</p>

<h3>Clipping the Surface</h3>
<p>
Display the molecular surface:
<blockquote>
<i>Command</i>: <b><a href="../midas/surface.html">surf</a></b>
</blockquote>
Start <a href="../../ContributedSoftware/per-model/per-model.html"><b>Per-Model 
Clipping</b></a> (under <b>Tools... Depiction</b>). In that dialog, 
set <b>Model</b> to the surface (not <b>2gbp</b> itself,
which contains the atoms) and turn on <b>Enable clipping</b>.  
Now part of the surface but not the atoms should be chopped away.
The planar cap is not yet colored by B-factor; that will have to be done in a
separate step.  Keep the clipping dialog open.
</p><p>
Hide all atoms except for the ligand, glucose:
<blockquote>
<i>Command</i>: <b><a href="../midas/show.html">show</a> ligand</b>
</blockquote>
Next, adjust the clipping of the surface to the desired angle and position
relative to the structure.  In the
<a href="../../ContributedSoftware/per-model/per-model.html"><b>Per-Model 
Clipping</b></a> dialog, turn on <b>Adjust clipping with mouse as below</b>
and use the specified mouse buttons to translate and rotate
the clipping plane.  A transparent green disk will be shown while you are
making these adjustments.  The mouse button assignments can be changed
if you prefer.  To return the mouse buttons to their normal functions, 
turn off <b>Adjust clipping with mouse as below</b>.
It may be necessary to turn it on and off a few times to position the clipping
plane to your satisfaction.  Once that has been done, 
either turn off <b>Adjust clipping with mouse as below</b> or just
<b>Close</b> the clipping dialog to return the mouse buttons to their
normal functions.
</p><p>
Select all atoms and use
<a href="../../ContributedSoftware/colorzone/colorzone.html"><b>Color 
Zone</b></a> to make the planar cap match these atoms:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">select</a> #</b>
<br>
<i>Command</i>: <b><a href="../midas/start.html">start</a> Color Zone</b>
</blockquote>
This tool is also under <b>Tools... Depiction</b> in the menu. 
Click the <b>Color</b> button and increase the <b>Coloring radius</b>
as needed to to color the whole cap.  A radius of ~3-4 &Aring;
should suffice. <b>Close</b> that tool and clear the selection:
<blockquote>
<i>Command</i>: <b><a href="../midas/select.html#newer">~select</a></b>
</blockquote>
</p>

<h3>Background, Labels, Color Key</h3>
<p>
Make the background white and turn off depth-cueing:
<blockquote>
<i>Command</i>: <b><a href="../midas/set.html">set</a> bg_color white</b>
<br>
<i>Command</i>: <b><a href="../midas/set.html">~set</a> depth_cue</b>
</blockquote>
Position the structure as you want it to appear in the final image,
leaving room for the title and color key.  If you want, save the position:
<blockquote>
<i>Command</i>: <b><a href="../midas/savepos.html">savepos</a> p1</b>
</blockquote>
Then if you accidentally move the structure later, the position can be
restored with:
<blockquote>
<i>Command</i>: <b><a href="../midas/reset.html">reset</a> p1</b>
</blockquote>
If you decide a later position is better, you can save it to a new name,
or the same name to overwrite the previously saved position:
<blockquote>
<i>Command</i>: <b><a href="../midas/savepos.html">savepos</a> p1</b>
</blockquote>
Open the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html#colorkey"><b>Color
Key</b></a> dialog (under <b>Tools... Utilities</b>).  In that dialog,
set the <b>Label color</b> to <b>black</b>
by clicking the <a href="../coloring.html#colorwell">color well</a>
and using the <a href="../colortool.html"><b>Color Editor</b></a>.
The appropriate <b>Font size</b> depends on the window size;
<b>26</b> was used with a 573 x 443 window.
</p><p>
Make sure that <b>Use mouse for key placement</b> is turned on and then
click-drag in the main window to draw the key.  It may take a few tries;
click-drag to start over, or click on the middle of the key
to drag it around.  To rotate the structure instead (and/or to prevent 
erasing the existing color key), turn off <b>Use mouse for key 
placement</b>.  When the key is drawn to your satisfaction, adjust
the <b>Border color</b> to <b>black</b> and the <b>Border with</b> to <b>2</b>.
</p><p>
To add additional text to the image, click the tab to go to the <b>Labels</b>
(<a href="../../ContributedSoftware/2dlabels/2dlabels.html"><b>2D 
Labels</b></a>)
section of the same dialog.  Set the <b>Color</b> to <b>black</b>, then
click in the graphics window to start a label and type to enter its contents.  
Each label can be repositioned by dragging
and its font size can be edited to a different value.
What font sizes are appropriate depends on the window size; 
use what you think looks best.  The <a href="2gbp-bfactor.png">example image</a>
was created using window size 573 x 443, font size 30 for the 
main title, and font size 28 for the text above the color key.
The &Aring; symbol and superscript &sup2; can be included by using
the <b>Insert symbol</b> menu.  Alternatively, symbols can be copied 
from text displays (such as a 
<a href="../../ContributedSoftware/2dlabels/symbols.html">symbols page</a>
or even the preceding sentence!) and pasted into the <b>Text</b> area of the
<a href="../../ContributedSoftware/2dlabels/2dlabels.html"><b>2D Labels</b></a>
dialog.  <b>Close</b> the dialog as soon as the labels are done, to allow 
rotating the structure and to avoid accidentally creating more labels.
</p>

<h3>Finishing Touches and Saving the Image</h3>
<p>
Things to do last before saving an image: 
<ul>
<li>set any parameters that may decrease interactivity or response time
by increasing computational demands
<li>save a <a href="../sessions.html">session file</a> 
so that you will be able to reproduce the image later
</ul>
Turn on silhouette edges:
<blockquote>
<i>Command</i>: <b><a href="../midas/set.html">set</a> silhouette</b>
<br>
<i>Command</i>: <b><a href="../midas/set.html">set</a> silhouette_width 2</b>
</blockquote>
The color patches on the planar cap look somewhat fuzzy because of
coarse surface triangulation.  Start 
<a href="../../ContributedSoftware/surfcapper/surfcapper.html"><b>Surface
Capping</b></a>:
<blockquote>
<i>Command</i>: <b><a href="../midas/start.html">start</a> Surface Capping</b>
</blockquote>
and change the <b>Mesh subdivision factor</b> to <b>3</b> to make the
triangles smaller and the color patches on the cap more distinct.  
<b>Close</b> that tool.
</p><p>
Similarly, smooth the molecular surface by increasing its vertex density:
<blockquote>
<i>Command</i>: <b><a href="../midas/setattr.html">setattr</a> s density 5</b>
</blockquote>
<a href="../sessions.html#savesess">Saving a session</a>
(see the <b>File</b> menu) right before or after saving the image
is recommended if you might need to regenerate the same or a similar figure 
later, say at a different resolution or with modified coloring.
</p><p>
The <a href="2gbp-bfactor.png">image</a> was saved at the same size as 
the window (573 x 443) using <b>File... Save Image</b> with default settings.
Different pixel dimensions could be specified by entering a different value 
for width (height) and clicking into the height (width) field, or by using
print units instead of pixels and specifying the the resolution in dpi.
</p>

<hr>
<address>meng-at-cgl.ucsf.edu / October 2009</address>
</body>
</html>
